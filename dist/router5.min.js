!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("router5-transition-path")):"function"==typeof define&&define.amd?define(["exports","router5-transition-path"],t):t(e.router5={},e.transitionPath)}(this,function(e,t){"use strict";var r="default"in t?t.default:t,n=function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a={trailingSlashMode:"default",queryParamsMode:"default",strictTrailingSlash:!1,autoCleanUp:!0,allowNotFound:!1,strongMatching:!0,rewritePathOnMatch:!0,caseSensitive:!1};var i=function(e){return void 0===e&&(e={}),{arrayFormat:e.arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}},o=function(e){return encodeURIComponent(e)},u=function(e){return decodeURIComponent(e)},s=function(e,t,r){return null===t?function(e,t){return"hidden"===t.nullFormat?"":"string"===t.nullFormat?e+"=null":e}(e,r):"boolean"==typeof t?function(e,t,r){return"empty-true"===r.booleanFormat&&t?e:e+"="+("unicode"===r.booleanFormat?t?"✓":"✗":t.toString())}(e,t,r):Array.isArray(t)?function(e,t,r){var n=function(e){return"index"===e.arrayFormat?function(e,t){return e+"["+t+"]"}:"brackets"===e.arrayFormat?function(e){return e+"[]"}:function(e){return e}}(r);return t.map(function(t,r){return n(e,r)+"="+o(t)}).join("&")}(e,t,r):e+"="+o(t)},c=function(e){var t=e.indexOf("?");return-1===t?e:e.slice(t+1)},f=function(e){var t=e.indexOf("["),r=-1!==t;return{hasBrackets:r,name:r?e.slice(0,t):e}},l=function(e,t){var r=i(t);return c(e).split("&").reduce(function(e,t){var n=t.split("="),a=n[0],i=n[1],o=f(a),s=o.hasBrackets,c=o.name,l=e[c],d=function(e,t){if(void 0===e)return"empty-true"===t.booleanFormat||null;if("string"===t.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}else if("unicode"===t.booleanFormat){if("✓"===u(e))return!0;if("✗"===u(e))return!1}else if("string"===t.nullFormat&&"null"===e)return null;return u(e)}(i,r);return e[c]=void 0===l?s?[d]:d:[].concat(l,d),e},{})},d=function(e,t){var r=i(t);return Object.keys(e).filter(function(t){return void 0!==e[t]}).map(function(t){return s(t,e[t],r)}).filter(Boolean).join("&")},p=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},h=function(e){return"("+(e?e.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~%':|=+\\*@]+")+")"},m=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(h(e[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^?]*)/},{name:"url-parameter-matrix",pattern:/^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(";"+e[1]+"="+h(e[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(e){return new RegExp("\\"+e[0])}},{name:"sub-delimiter",pattern:/^(!|&|-|_|\.|;)/,regex:function(e){return new RegExp(e[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(e){return new RegExp(e[0])}}],v=function(e,t){if(void 0===t&&(t=[]),!m.some(function(r){var n=e.match(r.pattern);return!!n&&(t.push({type:r.name,match:n[0],val:n.slice(1,2),otherVal:n.slice(2),regex:r.regex instanceof Function?r.regex(n):r.regex}),n[0].length<e.length&&(t=v(e.substr(n[0].length),t)),!0)}))throw new Error("Could not parse path '"+e+"'");return t},g=function(e){return e},y=function(e){return void 0!==e&&null!==e},T=function(){function e(e){if(!e)throw new Error("Missing path in Path constructor");this.path=e,this.tokens=v(e),this.hasUrlParams=this.tokens.filter(function(e){return/^url-parameter/.test(e.type)}).length>0,this.hasSpatParam=this.tokens.filter(function(e){return/splat$/.test(e.type)}).length>0,this.hasMatrixParams=this.tokens.filter(function(e){return/matrix$/.test(e.type)}).length>0,this.hasQueryParams=this.tokens.filter(function(e){return/^query-parameter/.test(e.type)}).length>0,this.spatParams=this.getParams("url-parameter-splat"),this.urlParams=this.getParams(/^url-parameter/),this.queryParams=this.getParams("query-parameter"),this.params=this.urlParams.concat(this.queryParams),this.source=this.tokens.filter(function(e){return void 0!==e.regex}).map(function(e){return e.regex.source}).join("")}return e.createPath=function(t){return new e(t)},e.prototype.isQueryParam=function(e){return-1!==this.queryParams.indexOf(e)},e.prototype.test=function(e,t){var r=this,n=p({strictTrailingSlash:!1,queryParams:{}},t),a=function(e,t){return t?e:"\\/"===e?e:e.replace(/\\\/$/,"")+"(?:\\/)?"}(this.source,n.strictTrailingSlash),i=this.urlTest(e,a+(this.hasQueryParams?"(\\?.*$|$)":"$"),t);if(!i||!this.hasQueryParams)return i;var o=l(e,n.queryParams);return 0===Object.keys(o).filter(function(e){return!r.isQueryParam(e)}).length?(Object.keys(o).forEach(function(e){return i[e]=o[e]}),i):null},e.prototype.partialTest=function(e,t){var r=this,n=p({delimited:!0,queryParams:{}},t),a=function(e,t){return t?/(\/)$/.test(e)?e:e+"(\\/|\\?|\\.|;|$)":e}(this.source,n.delimited),i=this.urlTest(e,a,n);if(!i)return i;if(!this.hasQueryParams)return i;var o=l(e,n.queryParams);return Object.keys(o).filter(function(e){return r.isQueryParam(e)}).forEach(function(e){return function(e,t,r){void 0===r&&(r="");var n=e[t];return e[t]=void 0===n?r:Array.isArray(n)?n.concat(r):[n,r],e}(i,e,o[e])}),i},e.prototype.build=function(e,t){var r=this;void 0===e&&(e={});var n=p({ignoreConstraints:!1,ignoreSearch:!1,queryParams:{}},t),a=Object.keys(e).filter(function(e){return!r.isQueryParam(e)}).reduce(function(t,n){if(!y(e[n]))return t;var a=e[n],i=r.isQueryParam(n)?g:encodeURI;return"boolean"==typeof a?t[n]=a:Array.isArray(a)?t[n]=a.map(i):t[n]=i(a),t},{});if(this.urlParams.some(function(t){return!y(e[t])})){var i=this.urlParams.filter(function(t){return!y(e[t])});throw new Error("Cannot build path: '"+this.path+"' requires missing parameters { "+i.join(", ")+" }")}if(!n.ignoreConstraints&&!this.tokens.filter(function(e){return/^url-parameter/.test(e.type)&&!/-splat$/.test(e.type)}).every(function(e){return new RegExp("^"+h(e.otherVal[0])+"$").test(a[e.val])}))throw new Error("Some parameters of '"+this.path+"' are of invalid format");var o=this.tokens.filter(function(e){return!1===/^query-parameter/.test(e.type)}).map(function(e){return"url-parameter-matrix"===e.type?";"+e.val+"="+a[e.val[0]]:/^url-parameter/.test(e.type)?a[e.val[0]]:e.match}).join("");if(n.ignoreSearch)return o;var u=this.queryParams.filter(function(t){return-1!==Object.keys(e).indexOf(t)}).reduce(function(t,r){return t[r]=e[r],t},{}),s=d(u,n.queryParams);return s?o+"?"+s:o},e.prototype.getParams=function(e){var t=e instanceof RegExp?function(t){return e.test(t.type)}:function(t){return t.type===e};return this.tokens.filter(t).map(function(e){return e.val[0]})},e.prototype.urlTest=function(e,t,r){var n=this,a=(void 0===r?{}:r).caseSensitive,i=new RegExp("^"+t,void 0!==a&&a?"":"i"),o=e.match(i);return o?this.urlParams.length?o.slice(1,this.urlParams.length+1).reduce(function(e,t,r){return e[n.urlParams[r]]=decodeURIComponent(t),e},{}):{}:null},e}(),S=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},O=function(e){var t="";return e.reduce(function(e,r){var n=r.parser.urlParams.reduce(function(e,t){return e[t]="url",e},{}),a=r.parser.queryParams.reduce(function(e,t){return e[t]="query",e},n);return void 0!==r.name&&(e[t=t?t+"."+r.name:r.name]=a),e},{})},P=function(e,t,r,n,a){void 0===n&&(n={});for(var o=n.queryParamsMode,u=void 0===o?"default":o,s=n.strictTrailingSlash,d=void 0!==s&&s,p=n.strongMatching,h=void 0===p||p,m=n.caseSensitive,v=void 0!==m&&m,g=1===e.length&&""===e[0].name,y=function(e){var o,s,p=void 0,m=t;if("/"===a&&"/"===e.path&&(m="/"+t),e.children.length||(o=e.parser.test(m,{caseSensitive:v,strictTrailingSlash:d,queryParams:n.queryParams})),o||(o=e.parser.partialTest(m,{delimited:h,caseSensitive:v,queryParams:n.queryParams})),o){var y=e.parser.build(o,{ignoreSearch:!0});d||e.children.length||(y=y.replace(/\/$/,"")),p=0===m.toLowerCase().indexOf(y.toLowerCase())?m.slice(y.length):m,d||e.children.length||(p=p.replace(/^\/\?/,"?"));var T=function(e,t,r){var n=i(r);if(""===c(e))return{querystring:"",removedParams:{}};var a=e.split("&").reduce(function(e,r){var n=e[0],a=e[1],i=r.split("=")[0],o=f(i).name;return-1===t.indexOf(o)?[n.concat(r),a]:[n,a.concat(r)]},[[],[]]),o=a[0],u=a[1];return{querystring:o.join("&"),removedParams:l(u.join("&"),n)}}((s=m.replace(y,""),s.split("?")[1]||""),e.parser.queryParams,n.queryParams).querystring;if(p=function(e){return e.split("?")[0]}(p)+(T?"?"+T:""),d||g||"/"!==p||/\/$/.test(y)||(p=""),r.segments.push(e),Object.keys(o).forEach(function(e){return r.params[e]=o[e]}),!g&&!p.length)return{value:r};if(!g&&"strict"!==u&&0===p.indexOf("?")){var S=l(p.slice(1),n.queryParams);return Object.keys(S).forEach(function(e){return r.params[e]=S[e]}),{value:r}}var O=e.getNonAbsoluteChildren();return O.length?{value:P(O,p,r,n,y)}:{value:null}}},T=0,S=e;T<S.length;T++){var O=y(S[T]);if("object"==typeof O)return O.value}return null};var E=function(e){return function(t,r){var n=t.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1"),a=r.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1");if("/"===n)return 1;if("/"===a)return-1;if(t.parser.hasSpatParam)return 1;if(r.parser.hasSpatParam)return-1;var i=(n.match(/\//g)||[]).length,o=(a.match(/\//g)||[]).length;if(i<o)return 1;if(i>o)return-1;var u=t.parser.urlParams.length,s=r.parser.urlParams.length;if(u<s)return-1;if(u>s)return 1;var c=(n.split("/").slice(-1)[0]||"").length,f=(a.split("/").slice(-1)[0]||"").length;return c<f?1:c>f?-1:e.indexOf(t)-e.indexOf(r)}},N=(S({},{queryParamsMode:"default",trailingSlashMode:"default"},{strongMatching:!0}),function(){function e(e,t,r,n,a,i,o){return void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=[]),void 0===i&&(i=!0),this.name=e,this.absolute=/^~/.test(t),this.path=this.absolute?t.slice(1):t,this.parser=this.path?new T(this.path):null,this.children=[],this.parent=a,this.checkParents(),this.add(r,n,!i&&!1!==o),i&&this.sortDescendants(),this}return e.prototype.getParentSegments=function(e){return void 0===e&&(e=[]),this.parent&&this.parent.parser?this.parent.getParentSegments(e.concat(this.parent)):e.reverse()},e.prototype.setParent=function(e){this.parent=e,this.checkParents()},e.prototype.setPath=function(e){void 0===e&&(e=""),this.path=e,this.parser=e?new T(e):null},e.prototype.add=function(t,r,n){var a=this;if(void 0===n&&(n=!0),void 0!==t&&null!==t){if(!(t instanceof Array)){if(!(t instanceof e||t instanceof Object))throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.");if(t instanceof e)t.setParent(this),this.addRouteNode(t,n);else{if(!t.name||!t.path)throw new Error("RouteNode.add() expects routes to have a name and a path defined.");var i=new e(t.name,t.path,t.children,r,this,!1,n),o=i.getParentSegments([i]).map(function(e){return e.name}).join(".");r&&r(S({},t,{name:o})),this.addRouteNode(i,n)}return this}t.forEach(function(e){return a.add(e,r,n)})}},e.prototype.addNode=function(t,r){return this.add(new e(t,r)),this},e.prototype.getPath=function(e){return(t=this.getSegmentsByName(e))?t.map(function(e){return e.path}).join(""):null;var t},e.prototype.getNonAbsoluteChildren=function(){return this.children.filter(function(e){return!e.absolute})},e.prototype.sortChildren=function(){var e,t;this.children.length&&(e=this.children,t=e.slice(0),e.sort(E(t)))},e.prototype.sortDescendants=function(){this.sortChildren(),this.children.forEach(function(e){return e.sortDescendants()})},e.prototype.buildPath=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),function(e,t,r){if(void 0===t&&(t={}),void 0===r&&(r={}),!e)return null;for(var n=r.queryParamsMode,a=void 0===n?"default":n,i=(r.trailingSlashMode,[]),o=[],u=0,s=e;u<s.length;u++){var c=s[u].parser;i.push.apply(i,c.queryParams),o.push.apply(o,c.urlParams),o.push.apply(o,c.spatParams)}if("loose"===a){var f=Object.keys(t).reduce(function(e,t){return-1===i.indexOf(t)&&-1===o.indexOf(t)?e.concat(t):e},[]);i.push.apply(i,f)}var l=i.reduce(function(e,r){return-1!==Object.keys(t).indexOf(r)&&(e[r]=t[r]),e},{}),p=d(l,r.queryParams),h=e.reduce(function(e,n){var a=n.parser.build(t,{ignoreSearch:!0,queryParams:r.queryParams});return n.absolute?a:e+a},"").replace(/\/\/{1,}/g,"/"),m=h;return"always"===r.trailingSlashMode?m=/\/$/.test(h)?h:h+"/":"never"===r.trailingSlashMode&&"/"!==h&&(m=/\/$/.test(h)?h.slice(0,-1):h),m+(p?"?"+p:"")}(this.getSegmentsByName(e),t,r)},e.prototype.buildState=function(e,t){void 0===t&&(t={});var r=this.getSegmentsByName(e);return r&&r.length?{name:e,params:t,meta:O(r)}:null},e.prototype.matchPath=function(e,t){void 0===t&&(t={}),""!==e||t.strictTrailingSlash||(e="/");var r=this.getSegmentsMatchingPath(e,t);if(r){var n=r.segments;if(n[0].absolute){var a=n[0].getParentSegments();n.reverse(),n.push.apply(n,a),n.reverse()}var i=n[n.length-1].findSlashChild();i&&n.push(i)}return function(e){return e&&e.segments&&e.segments.length?{name:e.segments.map(function(e){return e.name}).filter(function(e){return e}).join("."),params:e.params,meta:O(e.segments)}:null}(r)},e.prototype.addRouteNode=function(e,t){void 0===t&&(t=!0);var r=e.name.split(".");if(1===r.length){if(-1!==this.children.map(function(e){return e.name}).indexOf(e.name))throw new Error('Alias "'+e.name+'" is already defined in route node');if(-1!==this.children.map(function(e){return e.path}).indexOf(e.path))throw new Error('Path "'+e.path+'" is already defined in route node');this.children.push(e),t&&this.sortChildren()}else{var n=this.getSegmentsByName(r.slice(0,-1).join("."));if(!n)throw new Error("Could not add route named '"+e.name+"', parent is missing.");e.name=r[r.length-1],n[n.length-1].add(e)}return this},e.prototype.checkParents=function(){if(this.absolute&&this.hasParentsParams())throw new Error("[RouteNode] A RouteNode with an abolute path cannot have parents with route parameters")},e.prototype.hasParentsParams=function(){if(this.parent&&this.parent.parser){var e=this.parent.parser;return e.hasUrlParams||e.hasSpatParam||e.hasMatrixParams||e.hasQueryParams||this.parent.hasParentsParams()}return!1},e.prototype.findAbsoluteChildren=function(){return this.children.reduce(function(e,t){return e.concat(t.absolute?t:[]).concat(t.findAbsoluteChildren())},[])},e.prototype.findSlashChild=function(){return this.getNonAbsoluteChildren().filter(function(e){return e.parser&&/^\/(\?|$)/.test(e.parser.path)})[0]},e.prototype.getSegmentsByName=function(e){var t=[],r=this.parser?[this]:this.children;return(this.parser?[""]:[]).concat(e.split(".")).every(function(e){var n=function(e,t){var r=t.filter(function(t){return t.name===e});return r.length?r[0]:void 0}(e,r);return!!n&&(r=n.children,t.push(n),!0)})?t:null},e.prototype.getSegmentsMatchingPath=function(e,t){var r=(this.parser?[this]:this.children).reduce(function(e,t){return e.concat(t,t.findAbsoluteChildren())},[]),n=P(r,e,{segments:[],params:{}},t);return n&&1===n.segments.length&&""===n.segments[0].name?null:n},e}()),R={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},A={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"};function b(e){var t=0,r=null;return e.getState=function(){return r},e.setState=function(e){r=e},e.makeState=function(r,a,i,o,u){return{name:r,params:n({},e.config.defaultParams[r],a),path:i,meta:o?n({},o,{id:void 0===u?++t:u}):void 0}},e.makeNotFoundState=function(t,r){return e.makeState(A.UNKNOWN_ROUTE,{path:t},t,{options:r})},e.areStatesEqual=function(t,r,n){if(void 0===n&&(n=!0),t.name!==r.name)return!1;var a=function(t){return e.rootNode.getSegmentsByName(t).map(function(e){return e.parser.urlParams}).reduce(function(e,t){return e.concat(t)},[])},i=n?a(t.name):Object.keys(t.params),o=n?a(r.name):Object.keys(r.params);return i.length===o.length&&i.every(function(e){return t.params[e]===r.params[e]})},e.areStatesDescendants=function(e,t){return!!new RegExp("^"+e.name+"\\.(.*)$").test(t.name)&&Object.keys(e.params).every(function(r){return e.params[r]===t.params[r]})},e.forwardState=function(t,r){var a=e.config.forwardMap[t]||t;return{name:a,params:n({},e.config.defaultParams[t],e.config.defaultParams[a],r)}},e.buildState=function(t,r){var n=e.forwardState(t,r),a=n.name,i=n.params;return e.rootNode.buildState(a,i)},e}var _={onStart:A.ROUTER_START,onStop:A.ROUTER_STOP,onTransitionSuccess:A.TRANSITION_SUCCESS,onTransitionStart:A.TRANSITION_START,onTransitionError:A.TRANSITION_ERROR,onTransitionCancel:A.TRANSITION_CANCEL};function w(e){var t=[],r=[];return e.getPlugins=function(){return t},e.usePlugin=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(n){e.hasPlugin(n.pluginName)||(t.push(n),function(t){var n=e.executeFactory(t),a=Object.keys(_).map(function(t){if(n[t])return e.addEventListener(_[t],n[t])}).filter(Boolean);r.push.apply(r,a)}(n))}),e},e.hasPlugin=function(e){return t.filter(function(t){return t.pluginName===e||t.name===e}).length>0},e}function C(e){var t=[],r=[];return e.useMiddleware=function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];return n.forEach(function(n){t.push(n),r.push(e.executeFactory(n))}),e},e.clearMiddleware=function(){return t=[],r=[],e},e.getMiddlewareFactories=function(){return t},e.getMiddlewareFunctions=function(){return r},e}function I(e,t,r){var a=t.isCancelled,i=t.toState,o=t.fromState,u=t.errorKey,s=void 0===u?void 0:u,c=Array.isArray(e)?e:Object.keys(e),f=function(e){return"object"==typeof e&&void 0!==e.name&&void 0!==e.params&&void 0!==e.path},l=function(e,t,r,i){var u=function(e,t){var a,o;e?i(e):t&&t!==r&&f(t)?(a=t,((o=r).name!==a.name||o.params!==a.params||o.path!==a.path)&&console.error("[router5][transition] Warning: state values (name, params, path) were changed during transition process."),i(null,function(e,t){return n({},t,e,{meta:n({},t.meta,e.meta)})}(t,r))):i(null,r)},s=e.call(null,r,o,u);a()?u(null):"boolean"==typeof s?u(s?null:t):f(s)?u(null,s):s&&"function"==typeof s.then&&s.then(function(e){e instanceof Error?u({error:e},null):u(null,e)},function(e){e instanceof Error?(console.error(e.stack||e),u(n({},t,{promiseError:e}),null)):u("object"==typeof e?n({},t,e):t,null)})},d=function(t,n){var i;if(a())r();else if(t)r(t);else if(c.length){var o="string"==typeof c[0],u=s&&o?((i={})[s]=c[0],i):{},f=o?e[c[0]]:c[0];c=c.slice(1),l(f,u,n,d)}else r(null,n)};d(null,i)}var k=function(e,t){};function x(e){var a;function i(){return a&&(a("navigate"),a=null),e}function o(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var a=t[0],i=t[t.length-1],s="function"==typeof i?i:k,c="object"==typeof t[1]?t[1]:{},f="object"==typeof t[2]?t[2]:{};if(e.isStarted()){var l=e.buildState(a,c);if(!l){var d={code:R.ROUTE_NOT_FOUND};return s(d),void e.invokeEventListeners(A.TRANSITION_ERROR,null,e.getState(),d)}var p=e.makeState(l.name,l.params,e.buildPath(l.name,l.params),{params:l.meta,options:f}),h=!!e.getState()&&e.areStatesEqual(e.getState(),p,!1);if(h&&!f.reload&&!f.force){d={code:R.SAME_STATES};return s(d),void e.invokeEventListeners(A.TRANSITION_ERROR,p,e.getState(),d)}var m=h||f.reload?null:e.getState();return f.skipTransition?(s(null,p),k):u(p,m,f,function(t,r){if(t)if(t.redirect){var a=t.redirect;o(a.name,a.params,n({},f,{force:!0,redirected:!0}),s)}else s(t);else e.invokeEventListeners(A.TRANSITION_SUCCESS,r,m,f),s(null,r)})}s({code:R.ROUTER_NOT_STARTED})}function u(o,u,s,c){return void 0===s&&(s={}),void 0===c&&(c=k),i(),e.invokeEventListeners(A.TRANSITION_START,o,u),a=function(e,a,i,o,u){var s=!1,c=!1,f=e.getOptions(),l=e.getLifecycleFunctions(),d=l[0],p=l[1],h=e.getMiddlewareFunctions(),m=function(){return s},v=function(e,t){return n({},e,t instanceof Object?t:{error:t})},g=a.name===A.UNKNOWN_ROUTE,y={isCancelled:m,toState:a,fromState:i},T=r(a,i),S=T.toDeactivate,O=T.toActivate,P=!i||o.forceDeactivate?[]:function(e,t,r){I(S.filter(function(e){return d[e]}).reduce(function(e,t){var r;return n({},e,((r={})[t]=d[t],r))},{}),n({},y,{errorKey:"segment"}),function(e){return r(e?v({code:R.CANNOT_DEACTIVATE},e):null)})},E=g?[]:function(e,t,r){I(O.filter(function(e){return p[e]}).reduce(function(e,t){var r;return n({},e,((r={})[t]=p[t],r))},{}),n({},y,{errorKey:"segment"}),function(e){return r(e?v({code:R.CANNOT_ACTIVATE},e):null)})},N=h.length?function(e,t,r){return I(h,n({},y),function(t,n){return r(t?v({code:R.TRANSITION_ERR},t):null,n||e)})}:[];return I([].concat(P).concat(E).concat(N),y,function(r,n){if(c=!0,!m()){if(!r&&f.autoCleanUp){var i=t.nameToIDs(a.name);Object.keys(d).forEach(function(t){-1===i.indexOf(t)&&e.clearCanDeactivate(t)})}u(r,n||a)}}),function(){s||c||(s=!0,u({code:R.TRANSITION_CANCELLED},null))}}(e,o,u,s,function(t,r){a=null,r=r||o,t?(t.code===R.TRANSITION_CANCELLED?e.invokeEventListeners(A.TRANSITION_CANCEL,o,u):e.invokeEventListeners(A.TRANSITION_ERROR,o,u,t),c(t)):(e.setState(r),c(null,r))})}return e.config.forwardMap={},e.navigate=o,e.cancel=i,e.transitionToState=u,e.navigate=o,e.navigateToDefault=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n="object"==typeof t[0]?t[0]:{},a=2===t.length?t[1]:"function"==typeof t[0]?t[0]:k,i=e.getOptions();return i.defaultRoute?o(i.defaultRoute,i.defaultParams,n,a):function(){}},e.forward=function(t,r){return e.config.forwardMap[t]=r,e},e}var j=function(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")());function q(e){var t=[];function r(e){var r="object"==typeof e,n=r?e.next.bind(e):e;t=t.concat(n);var a=function(){var e;(e=n)&&(t=t.filter(function(t){return t!==e}))};return r?{unsubscribe:a}:a}return e.subscribe=r,e[j]=function(){var e;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");return r(e)}})[j]=function(){return this},e},e.addEventListener(A.TRANSITION_SUCCESS,function(e,r){t.forEach(function(t){return t({route:e,previousRoute:r})})}),e}var D=function(){};function U(e){var t=!1;return e.isStarted=function(){return t},e.start=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var a,i,o=e.getOptions(),u=r[r.length-1],s="function"==typeof u?u:D,c="function"!=typeof r[0]?r[0]:void 0;if(t)return s({code:R.ROUTER_ALREADY_STARTED}),e;t=!0,e.invokeEventListeners(A.ROUTER_START);var f=function(t,r,n){void 0===n&&(n=!0),t||e.invokeEventListeners(A.TRANSITION_SUCCESS,r,null,{replace:!0}),t&&n&&e.invokeEventListeners(A.TRANSITION_ERROR,r,null,t),s(t,r)};if(void 0===c&&!o.defaultRoute)return f({code:R.NO_START_PATH_OR_STATE});if("string"==typeof c?a=c:"object"==typeof c&&(i=c),i)e.setState(i),f(null,i);else{var l=function(t){e.transitionToState(t,e.getState(),{},function(t,r){var n;t?t.redirect?(n=t.redirect,e.navigate(n.name,n.params,{replace:!0,reload:!0,redirected:!0},s)):o.defaultRoute?e.navigateToDefault({replace:!0},s):f(t,null,!1):f(null,r)})};(i=void 0===a?null:e.matchPath(a))?l(i):o.defaultRoute?e.navigateToDefault():o.allowNotFound?l(e.makeNotFoundState(a,{replace:!0})):f({code:R.ROUTE_NOT_FOUND,path:a},null)}return e},e.stop=function(){return t&&(e.setState(null),t=!1,e.invokeEventListeners(A.ROUTER_STOP)),e},e}var F=function(e){return"function"==typeof e?e:function(){return function(){return e}}};function M(e){var t={},r={},n={},a={};return e.getLifecycleFactories=function(){return[t,r]},e.getLifecycleFunctions=function(){return[n,a]},e.canDeactivate=function(r,a){var i=F(a);return t[r]=i,n[r]=e.executeFactory(i),e},e.clearCanDeactivate=function(r){return t[r]=void 0,n[r]=void 0,e},e.canActivate=function(t,n){var i=F(n);return r[t]=i,a[t]=e.executeFactory(i),e},e}function L(e){var t={};return e.invokeEventListeners=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];(t[e]||[]).forEach(function(e){return e.apply(void 0,r)})},e.removeEventListener=function(e,r){t[e]=t[e].filter(function(e){return e!==r})},e.addEventListener=function(e,r){return t[e]=(t[e]||[]).concat(r),function(){return removeEventListener(e,r)}},e}var $=function(e,t,r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return e.reduce(function(e,t){return t(e)},t)}}(function(e){return function(t){var r=n({},a,e);return t.getOptions=function(){return r},t.setOption=function(e,n){return r[e]=n,t},t}}(t),function(e){return function(t){var r=e instanceof N?e:new N("","",e,a);function a(e){e.decodeParams&&(t.config.decoders[e.name]=e.decodeParams),e.encodeParams&&(t.config.encoders[e.name]=e.encodeParams),e.defaultParams&&(t.config.defaultParams[e.name]=e.defaultParams)}return t.rootNode=r,t.add=function(e,n){return r.add(e,a,!n),n&&r.sortDescendants(),t},t.addNode=function(e,n,a){return r.addNode(e,n),t},t.isActive=function(e,r,n,a){void 0===r&&(r={}),void 0===n&&(n=!1),void 0===a&&(a=!0);var i=t.getState();return!!i&&(n||i.name===e?t.areStatesEqual(t.makeState(e,r),i,a):t.areStatesDescendants(t.makeState(e,r),i))},t.buildPath=function(e,r){if(e===A.UNKNOWN_ROUTE)return r.path;var a=n({},t.config.defaultParams[e],r),i=t.getOptions(),o=i.trailingSlashMode,u=i.queryParamsMode,s=i.queryParams,c=t.config.encoders[e]?t.config.encoders[e](a):a;return t.rootNode.buildPath(e,c,{trailingSlashMode:o,queryParamsMode:u,queryParams:s})},t.matchPath=function(e,r){var n=t.getOptions(),a=t.rootNode.matchPath(e,n);if(a){var i=a.name,o=a.params,u=a.meta,s=t.config.decoders[i]?t.config.decoders[i](o):o,c=t.forwardState(i,s),f=c.name,l=c.params,d=!1===n.rewritePathOnMatch?e:t.buildPath(f,l);return t.makeState(f,l,d,{params:u,source:r})}return null},t.setRootPath=function(e){t.rootNode.setPath(e)},t}}(e),function(e){return function(t){var r=e;return t.setDependency=function(e,n){return r[e]=n,t},t.setDependencies=function(e){return Object.keys(e).forEach(function(r){return t.setDependency(r,e[r])}),t},t.getDependencies=function(){return r},t.getInjectables=function(){return[t,t.getDependencies()]},t.executeFactory=function(e){return e.apply(void 0,t.getInjectables())},t}}(r),b,L,U,M,x,q,w,C,function(e){return function(t){return t.clone=function(r){var a=n({},t.getDependencies(),r),i=e(t.rootNode,t.getOptions(),a);i.useMiddleware.apply(i,t.getMiddlewareFactories()),i.usePlugin.apply(i,t.getPlugins()),i.config=t.config;var o=t.getLifecycleFactories(),u=o[0],s=o[1];return Object.keys(u).forEach(function(e){return i.canDeactivate(e,u[e])}),Object.keys(s).forEach(function(e){return i.canActivate(e,s[e])}),i},t}}($))({})};e.transitionPath=r,e.default=$,e.createRouter=$,e.RouteNode=N,e.constants=A,e.errorCodes=R,Object.defineProperty(e,"__esModule",{value:!0})});
